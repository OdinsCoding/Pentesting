#!/bin/bash

httptype=$1
host=$2
path=$3
line=`echo "-------------------------------------------------"`
dt=`date +"%Y_%m_%d_%H%M%S"`

#-------Colores-------
endColor="\033[0m\e[0m"
redColor="\e[0;31m\033[1m"
grayColor="\e[0;37m\033[1m"
greenColor="\e[0;32m\033[1m"

function helpPanel (){
	echo -e "\n\t[+] Usage: ./BadLinks.sh http/https domains.txt /targetpath"
	exit 1
}

if [ -f $dt"/temp.tmp" ];then
   rm -f $dt"/temp.tmp"
fi

function checker (){
	carpeta=`mkdir $dt`
	for i in $(cat $host | sort -u );do
		request=`curl -sk --max-time 2 "$httptype://$i$path"`
		if [ $? -eq 0 ]; then
			echo $line
			echo -e "[x] Host: $i - $path exposed : $httptype://$i$path" >> $dt"/report.txt"
			echo -e "${redColor}"$(tail -n1 $dt"/report.txt")"${endColor}"
		else
			echo $line
			echo -e "[✔] Host: $i - $path  not exposed" >> $dt"/report.txt"
			echo -e "${greenColor}"$(tail -n1 $dt"/report.txt")"${endColor}"
		fi
	done

	echo $line; sleep 1
	echo -e "  ${greenColor}[✔]${endColor}${grayColor} Total Host OK:    ${endColor}${greenColor}"$(cat $dt"/report.txt" | grep "\[✔\]" | wc -l)"${endColor}"
	echo $line; sleep 1
	echo -e "  ${redColor}[x]${endColor}${grayColor} Total Host Detected:    ${endColor}${redColor}"$(cat $dt"/report.txt" | grep "\[x\]" | wc -l)"${endColor}"
	echo $line; sleep 1
	rm -f $dt"/temp.tmp" >/dev/null 2>&1
	exit 0
}


if [ $# -eq 0 ]; then
	helpPanel
else
	checker
fi
