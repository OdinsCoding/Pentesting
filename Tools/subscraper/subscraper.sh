#!/bin/bash

url=$1

if [ ! -d "$url" ];then
      echo -e "\n [+] Building directory $url..."
      mkdir $url
else
      echo -e  " \n [-] The directory $url already exist. Proceeding..."
fi

if [ ! -d "$url/recon" ];then
      echo -e "\n [+] Building directory recon..."
      mkdir $url/recon
else
      echo -e "\n [-] The directory recon already exist. Proceeding..."
fi


echo -e "\n [+] Harvesting subdomains with assetfinder... "
assetfinder $url > $url/recon/assets.txt
echo -e "\n [+] Filtering for subdomains of $url only..."
cat $url/recon/assets.txt | grep $1 |sort -u > $url/recon/assetfinder_subdomains.txt
rm $url/recon/assets.txt

echo -e "\n [+] Harvesting subdomains with amass... "
amass enum -r 8.8.8.8 -d $url > $url/recon/a.txt
cat $url/recon/a.txt | sort -u > $url/recon/amass_subdomains.txt
rm $url/recon/a.txt

echo -e "\n [+] Harvesting subdomains with crt.sh..."
curl -s https://crt.sh/?q=%25.$url > $url/recon/crtsh.out
cat $url/recon/crtsh.out | grep $url | grep TD | sed -e 's/<//g' | sed -e 's/>//g' | sed -e 's/TD//g' | sed -e 's/\///g' | sed -e 's/ //g' | sed -n '1!p' | sort -u > $url/recon/$url-crt.txt

cat $url/recon/$url-crt.txt >> $url/recon/subs.txt
cat $url/recon/assetfinder_subdomains.txt >> $url/recon/subs.txt
cat $url/recon/amass_subdomains.txt >> $url/recon/subs.txt
cat $url/recon/subs.txt | sort -u > $url/recon/subdomains.txt
rm $url/recon/subs.txt
rm $url/recon/assetfinder_subdomains.txt
rm $url/recon/amass_subdomains.txt
rm $url/recon/crtsh.out
rm $url/recon/$url-crt.txt

echo -e "\n [+] Probing for alive domains..."
cat $url/recon/subdomains.txt | httprobe | sed 's/https\?:\/\///' | sed 's/http\?:\/\///' | sort -u > $url/recon/probe.txt
cat $url/recon/probe.txt | sort -u > $url/recon/livedomains.txt
rm $url/recon/probe.txt

echo -e "\n The amount of live host:"
wc -l $url/recon/livedomains.txt | cut -f1


while true
do
      read -r -p "Would you like to capture images of the live hosts? [Y/n] " input
 
      case $input in
            [yY]|[yY])
                 echo -e "\n [+] Capturing images of alive domains..."
                 gowitness file -f $url/recon/livedomains.txt
                 mv screenshots $url/recon/gowitness
                  break
                  ;;
            [nN]|[nN])
                  break
                  ;;
            *)
                  echo "Invalid input..."
                  ;;
      esac      
done


echo -e "\n [Success] All subdomains of $url have been collected in the $url/recon directory!"